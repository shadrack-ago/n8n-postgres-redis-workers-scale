# üöÄ Deploy n8n on Cloud (PostgreSQL + Redis + Workers)

This guide shows you how to deploy your scalable n8n setup to the cloud with PostgreSQL, Redis, and multiple workers. This is **n8n on steroids** - designed for production workloads and horizontal scaling.

## üåê Choose Your Cloud Provider

### Option 1: Google Cloud Platform (Recommended)
- Free tier available
- Excellent performance
- Easy DNS management

### Option 2: AWS EC2
- Free tier available
- Industry standard
- Great documentation

### Option 3: DigitalOcean
- Simple pricing
- Developer-friendly
- Good performance

---

## üìã Step 1: Set Up Your Cloud Server

### For Google Cloud:
```bash
# Create VM instance (Ubuntu 22.04)
# - Choose e2-micro (free tier)
# - Allow HTTP/HTTPS traffic
# - Note the External IP
```

### For AWS EC2:
```bash
# Launch t2.micro (free tier)
# - Ubuntu 22.04 AMI
# - Security Group: Allow 80, 443, 22
# - Note the Public IP
```

---

## üîó Step 2: Configure Your Domain

1. **Buy a domain** (GoDaddy, Namecheap, ionos etc.) >proceed to 2 if you have a domain
2. **Create DNS A record:**
   - Type: A
   - Name: n8n (or your preferred subdomain)
   - Value: YOUR_SERVER_IP
   - TTL: 300 (or default)

**Example:** `n8n.yourdomain.com` ‚Üí `123.45.67.89`

*Wait 5-30 minutes for DNS propagation*
use DNS checker to check if your domain is propagated

---

## üõ†Ô∏è Step 3: Prepare Your Server

SSH into your server:
```bash
ssh username@YOUR_SERVER_IP
```

Update and install essentials:
```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install required packages
sudo apt install -y curl wget nano git

# Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Install Docker Compose
sudo apt install -y docker-compose-plugin

# Add user to docker group
sudo usermod -aG docker $USER

# Reboot to apply changes
sudo reboot
```

After reboot, SSH back in and verify:
```bash
docker --version
docker compose version
```

---

## üìÅ Step 4: Set Up Project Directory

```bash
# Create project directory
mkdir n8n-cloud
cd n8n-cloud

# Create necessary directories
mkdir local-files
mkdir backups
```

---

## ‚öôÔ∏è Step 5: Create Environment Configuration

Create `.env` file:
```bash
nano .env
```

Add this configuration:
```bash
# ============================================
# n8n CLOUD CONFIGURATION
# ============================================

# Domain Settings
DOMAIN_NAME=yourdomain.com
SUBDOMAIN=n8n
SSL_EMAIL=your-email@domain.com

# Timezone (find yours: https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)
GENERIC_TIMEZONE=Africa/Nairobi

# Security
N8N_ENCRYPTION_KEY=your-super-secret-encryption-key-change-this

# Database Configuration
POSTGRES_USER=n8n_user
POSTGRES_PASSWORD=your-secure-postgres-password
POSTGRES_DB=n8n
POSTGRES_NON_ROOT_USER=n8n_user
POSTGRES_NON_ROOT_PASSWORD=your-secure-postgres-password

# n8n Configuration
N8N_HOST=${SUBDOMAIN}.${DOMAIN_NAME}
N8N_PROTOCOL=https
NODE_ENV=production
N8N_BASIC_AUTH_ACTIVE=true
N8N_BASIC_AUTH_USER=admin
N8N_BASIC_AUTH_PASSWORD=your-secure-admin-password

# Performance Settings
N8N_DEFAULT_BINARY_DATA_MODE=filesystem
N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=true
N8N_RUNNERS_ENABLED=true
EXECUTIONS_MODE=queue
QUEUE_BULL_REDIS_HOST=redis
QUEUE_HEALTH_CHECK_ACTIVE=true
```

**Save:** Ctrl+O, Enter, then Ctrl+X

---

## üê≥ Step 6: Create Docker Compose File

Create `docker-compose.yml`:
```bash
nano docker-compose.yml
```

Paste this production-ready configuration:
```yaml
volumes:
  db_storage:
  n8n_storage:
  redis_storage:
  traefik_data:

x-shared: &shared
  restart: always
  environment:
    - DB_TYPE=postgresdb
    - DB_POSTGRESDB_HOST=postgres
    - DB_POSTGRESDB_PORT=5432
    - DB_POSTGRESDB_DATABASE=${POSTGRES_DB}
    - DB_POSTGRESDB_USER=${POSTGRES_USER}
    - DB_POSTGRESDB_PASSWORD=${POSTGRES_PASSWORD}
    - N8N_BASIC_AUTH_ACTIVE=${N8N_BASIC_AUTH_ACTIVE}
    - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY}
    - N8N_HOST=${N8N_HOST}
    - N8N_PROTOCOL=${N8N_PROTOCOL}
    - N8N_RUNNERS_ENABLED=${N8N_RUNNERS_ENABLED}
    - NODE_ENV=${NODE_ENV}
    - WEBHOOK_URL=${N8N_PROTOCOL}://${N8N_HOST}/
    - WEBHOOK_TUNNEL_URL=${N8N_PROTOCOL}://${N8N_HOST}/
    - GENERIC_TIMEZONE=${GENERIC_TIMEZONE}
    - EXECUTIONS_MODE=${EXECUTIONS_MODE}
    - QUEUE_BULL_REDIS_HOST=${QUEUE_BULL_REDIS_HOST}
    - QUEUE_HEALTH_CHECK_ACTIVE=${QUEUE_HEALTH_CHECK_ACTIVE}
    - N8N_BASIC_AUTH_USER=${N8N_BASIC_AUTH_USER}
    - N8N_BASIC_AUTH_PASSWORD=${N8N_BASIC_AUTH_PASSWORD}
    - N8N_DEFAULT_BINARY_DATA_MODE=${N8N_DEFAULT_BINARY_DATA_MODE}
    - N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=${N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE}
  links:
    - postgres
    - redis
  volumes:
    - n8n_storage:/home/node/.n8n
    - ./local-files:/files
  depends_on:
    redis:
      condition: service_healthy
    postgres:
      condition: service_healthy

services:
  # Traefik Reverse Proxy with SSL
  traefik:
    image: traefik:v3.0
    restart: always
    command:
      - "--api=true"
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
      - "--entrypoints.web.http.redirections.entryPoint.to=websecure"
      - "--entrypoints.web.http.redirections.entryPoint.scheme=https"
      - "--entrypoints.websecure.address=:443"
      - "--certificatesresolvers.mytlschallenge.acme.tlschallenge=true"
      - "--certificatesresolvers.mytlschallenge.acme.email=${SSL_EMAIL}"
      - "--certificatesresolvers.mytlschallenge.acme.storage=/letsencrypt/acme.json"
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - traefik_data:/letsencrypt
      - /var/run/docker.sock:/var/run/docker.sock:ro

  # PostgreSQL Database
  postgres:
    image: postgres:17
    restart: always
    environment:
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_DB=${POSTGRES_DB}
    volumes:
      - db_storage:/var/lib/postgresql/data
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -h localhost -U ${POSTGRES_USER} -d ${POSTGRES_DB}']
      interval: 5s
      timeout: 5s
      retries: 10

  # Redis for Queue Management
  redis:
    image: redis:7-alpine
    restart: always
    volumes:
      - redis_storage:/data
    healthcheck:
      test: ['CMD', 'redis-cli', 'ping']
      interval: 5s
      timeout: 5s
      retries: 10

  # n8n Main Instance
  n8n:
    <<: *shared
    image: docker.n8n.io/n8nio/n8n
    command: start
    labels:
      - traefik.enable=true
      - traefik.http.routers.n8n.rule=Host(`${N8N_HOST}`)
      - traefik.http.routers.n8n.tls=true
      - traefik.http.routers.n8n.entrypoints=web,websecure
      - traefik.http.routers.n8n.tls.certresolver=mytlschallenge
      - traefik.http.middlewares.n8n.headers.SSLRedirect=true
      - traefik.http.middlewares.n8n.headers.STSSeconds=315360000
      - traefik.http.middlewares.n8n.headers.browserXSSFilter=true
      - traefik.http.middlewares.n8n.headers.contentTypeNosniff=true
      - traefik.http.middlewares.n8n.headers.forceSTSHeader=true
      - traefik.http.middlewares.n8n.headers.SSLHost=${DOMAIN_NAME}
      - traefik.http.middlewares.n8n.headers.STSIncludeSubdomains=true
      - traefik.http.middlewares.n8n.headers.STSPreload=true
      - traefik.http.routers.n8n.middlewares=n8n@docker

  # n8n Worker 1
  n8n-worker-1:
    <<: *shared
    image: docker.n8n.io/n8nio/n8n
    command: worker
    depends_on:
      - n8n

  # n8n Worker 2
  n8n-worker-2:
    <<: *shared
    image: docker.n8n.io/n8nio/n8n
    command: worker
    depends_on:
      - n8n

  # Add more workers for increased capacity
  # n8n-worker-3:
  #   <<: *shared
  #   image: docker.n8n.io/n8nio/n8n
  #   command: worker
  #   depends_on:
  #     - n8n
```

**Save:** Ctrl+O, Enter, then Ctrl+X

---

## üöÄ Step 7: Launch Your n8n Instance

```bash
# Pull all images and start containers
docker compose pull
docker compose up -d

# Check status
docker compose ps

# View logs
docker compose logs -f
```

**Wait 2-5 minutes for SSL certificates to generate**

---

## üîí Step 8: Access and Secure

1. **Access n8n:** `https://n8n.yourdomain.com`
2. **Login with your credentials** (from .env file)
3. **Change default password** immediately
4. **Configure your workflows**

---

## üìä Step 9: Monitor and Scale

### Check System Status:
```bash
# Container status
docker compose ps

# Resource usage
docker stats

# Logs for specific service
docker compose logs -f n8n
docker compose logs -f n8n-worker-1
```

### Add More Workers (Scaling):
Edit `docker-compose.yml` and uncomment/add worker sections, then:
```bash
docker compose up -d
```

### Backup Your Data:
```bash
# Create backup script
nano backup.sh
```

Add this backup script:
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="./backups"

# Create backup directory
mkdir -p $BACKUP_DIR

# Backup n8n data
docker run --rm -v n8n-cloud_n8n_storage:/data -v $(pwd)/$BACKUP_DIR:/backup alpine tar czf /backup/n8n_data_$DATE.tar.gz -C /data .

# Backup PostgreSQL
docker exec n8n-cloud-postgres-1 pg_dump -U n8n_user n8n > $BACKUP_DIR/postgres_$DATE.sql

# Clean old backups (keep last 7 days)
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete

echo "Backup completed: $DATE"
```

Make it executable and set up cron:
```bash
chmod +x backup.sh
crontab -e
```

Add for daily backups at 2 AM:
```bash
0 2 * * * /home/username/n8n-cloud/backup.sh
```

---

## üîß Maintenance Commands

### Update n8n:
```bash
docker compose pull
docker compose up -d
```

### Restart services:
```bash
docker compose restart
```

### View resource usage:
```bash
docker stats --no-stream
```

### Clean up unused images:
```bash
docker system prune -f
```

---

## üéØ Performance Tips

1. **Monitor RAM usage** - Add more workers if you have spare RAM
2. **Scale vertically** - Upgrade to larger VM if needed
3. **Use CDN** - For static assets in high-traffic scenarios
4. **Monitor disk space** - Set up alerts for low disk space
5. **Regular backups** - Automate daily backups

---

## üÜò Troubleshooting

### n8n not accessible:
```bash
# Check container status
docker compose ps

# Check logs
docker compose logs n8n

# Check Traefik dashboard: http://your-server-ip:8080
```

### SSL certificate issues:
```bash
# Check Traefik logs
docker compose logs traefik

# Force certificate renewal
docker compose restart traefik
```

### Database connection issues:
```bash
# Check PostgreSQL logs
docker compose logs postgres

# Test connection
docker exec -it n8n-cloud-postgres-1 psql -U n8n_user -d n8n
```

---

## üéâ You're Done!

You now have a **production-ready, scalable n8n instance** running on the cloud with:
- ‚úÖ Automatic SSL certificates
- ‚úÖ PostgreSQL database
- ‚úÖ Redis queue system
- ‚úÖ Multiple workers for scaling
- ‚úÖ Automated backups
- ‚úÖ HTTPS security
- ‚úÖ Professional domain setup

**This is n8n on steroids - ready for enterprise workloads!** üöÄ

---

## üìû Need Help?

- Check logs: `docker compose logs -f`
- Restart services: `docker compose restart`
- Update n8n: `docker compose pull && docker compose up -d`

Enjoy your scalable cloud n8n instance! üéä